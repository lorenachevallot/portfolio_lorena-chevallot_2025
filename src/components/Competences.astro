---
import Strat from "../assets/stat.svg";
import roue from "../assets/roue.svg";
import ordi from "../assets/ordi.svg";
import design from "../assets/design.svg";
import fleur_3 from "../assets/fleur_3.webp";

const carouselData = [
    {
        title: "Stratégie & storytelling",
        shortTitle: "Stratégie",
        description: `
            <ul class="list-disc list-inside text-left space-y-4">
                <li>Définition d'une ligne éditoriale claire et d'un ton adapté aux cibles</li>
                <li>Storytelling orienté objectifs (marque, projet, association)</li>
                <li>Choix pertinents des canaux et formats selon le message</li>
            </ul>
        `,
        icon: Strat,
        link: "/Stratégie & storytelling",
    },
    {
        title: "Design & identité visuelle",
        shortTitle: "Design",
        description: `
            <ul class="list-disc list-inside text-left space-y-4">
                <li>Maquettes Figma et déclinaisons multi-supports, print & web</li>
                <li>Création d'identités (logo, palette, typographies, usages)</li>
                <li>Respect des codes graphiques et lisibilité</li>
            </ul>
        `,
        icon: design,
        link: "/design",
    },
    {
        title: "Développement Web",
        shortTitle: "Dev Web",
        description: `
            <ul class="list-disc list-inside text-left space-y-4">
                <li>Création de sites web modernes et responsifs</li>
                <li>Maîtrise des technologies front-end (HTML, CSS, JavaScript, React, Astro)</li>
                <li>Développement back-end et intégration d'APIs</li>
            </ul>
        `,
        icon: ordi,
        link: "/developpement",
    },
    {
        title: "Audiovisuel",
        shortTitle: "Audiovisuel",
        description: `
            <ul class="list-disc list-inside text-left space-y-4">
                <li>Réalisation et tournage de contenus vidéo professionnels</li>
                <li>Montage et post-production (effets, colorimétrie, son)</li>
                <li>Création de contenus engageants pour différentes plateformes</li>
            </ul>
        `,
        icon: roue,
        link: "/audiovisuel",
    },
];
---

<section id="competences" class="relative text-white py-16 md:py-14 lg:py-25">
    <!-- Décoration florale avec sphères statiques -->
    <div
        class="absolute right-0 bottom-16 w-[60dvw] h-[60dvw] md:w-[200px] md:h-[200px] lg:w-[280px] lg:h-[280px] pointer-events-none -z-10"
    >
        <!-- Sphères colorées statiques (derrière la fleur) - Plus grosses -->

        <!-- Sphère bleue 1 (grande) - en haut décalée à droite et descendue -->
        <div
            class="absolute rounded-full opacity-80 pointer-events-none"
            style="background: radial-gradient(ellipse at center, #3600c9 0%, transparent 55%); filter: blur(40px); z-index: 1; left: 50%; top: 50%; transform: translate(-35%, -65%); width: 525px; height: 525px;"
        >
        </div>

        <!-- Sphère orange (très grande) - au centre -->
        <div
            class="absolute rounded-full opacity-85 pointer-events-none"
            style="background: radial-gradient(ellipse at center, #fd772b 0%, transparent 55%); filter: blur(45px); z-index: 2; left: 50%; top: 50%; transform: translate(-50%, -50%); width: 600px; height: 600px;"
        >
        </div>

        <!-- Sphère rouge (grande) - en bas décalée à droite et remontée -->
        <div
            class="absolute rounded-full opacity-80 pointer-events-none"
            style="background: radial-gradient(ellipse at center, #cc1d48 0%, transparent 55%); filter: blur(40px); z-index: 3; left: 50%; top: 50%; transform: translate(-35%, -35%); width: 525px; height: 525px;"
        >
        </div>

        <!-- Sphère bleue 2 (grande) - décalée légèrement à droite du centre -->
        <div
            class="absolute rounded-full opacity-75 pointer-events-none"
            style="background: radial-gradient(ellipse at center, #3600c9 0%, transparent 55%); filter: blur(40px); z-index: 1.5; left: 50%; top: 50%; transform: translate(-45%, -55%); width: 480px; height: 480px;"
        >
        </div>

        <!-- Sphère bleue 3 (moyenne) - décalée légèrement à gauche du centre -->
        <div
            class="absolute rounded-full opacity-75 pointer-events-none"
            style="background: radial-gradient(ellipse at center, #3600c9 0%, transparent 55%); filter: blur(35px); z-index: 4; left: 50%; top: 50%; transform: translate(-55%, -48%); width: 450px; height: 450px;"
        >
        </div>

        <!-- Anneau blanc sans flou avec shadow - positionné en haut centre, moitié visible -->
        <div
            class="absolute rounded-full pointer-events-none border-4 border-white"
            style="z-index: 5; left: 80%; top: 10%; transform: translate(-50%, -50%); width: 247.5px; height: 247.5px; box-shadow: 0 0 30px rgba(255, 255, 255, 0.8), 0 0 50px rgba(255, 255, 255, 0.5), inset 0 0 20px rgba(255, 255, 255, 0.3);"
        >
        </div>

        <!-- Fleur (au-dessus de tout) -->
        <img
            src={fleur_3.src}
            alt="Fleur décorative"
            class="absolute right-0 -top-10 min-w-[30dvw] lg:min-w-[10dvw] min-h-[30dvw] lg:min-h-[10dvw] object-contain object-right opacity-100 z-10"
        />
    </div>

    <div class="w-full px-4 md:px-8 lg:px-16">
        <!-- Titre de la section -->
        <div class="mb-8 lg:mb-10 w-full max-w-[700px] lg:max-w-[1200px]">
            <h2>Compétences</h2>
        </div>

        <!-- Texte introductif avec animation -->
        <div class="mb-4 lg:mb-6 w-full max-w-[700px] lg:max-w-[1200px]">
            <div
                class="h-0.5 bg-white mb-4 max-w-5xl"
                style="box-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.6);"
            >
            </div>
            <p class="animated-text max-w-5xl" data-animated="false">
                Je donne du sens aux projets en construisant des messages
                clairs, cohérents et porteurs de valeur.Qu'il s'agisse de
                structurer une idée, de raconter une histoire ou de faire le
                lien entre l'image et les mots, j'interviens pour créer une
                communication juste, à la fois réfléchie et sensible. J'accorde
                autant d'importance à l'intention qu'à sa perception, du fond à
                la forme.
            </p>
        </div>

        <!-- Carousel -->
        <div
            class="w-full py-0 text-white flex flex-col items-center rounded-2xl lg:flex-row lg:justify-between lg:py-0 lg:gap-8 max-w-[700px] lg:max-w-[1000px]"
        >
            <div class="w-full h-full flex justify-center items-center">
                <div
                    class="carousel-main-card relative bg-gradient-to-br from-zinc-900/95 to-zinc-950/95 rounded-2xl backdrop-blur-md w-full flex flex-col items-start px-4 py-5 shadow-2xl border border-violet-500/20 h-[320px] sm:h-[340px] md:h-[360px] lg:h-[280px] overflow-y-auto transition-all duration-300"
                    id="carousel-main"
                >
                    {
                        carouselData.map((item, index) => (
                            <div
                                class={`carousel-slide w-full h-full flex flex-col gap-4 transition-all duration-500 ${index === 0 ? "opacity-100" : "opacity-0 hidden"}`}
                                data-index={index}
                            >
                                {/* Titre et icône côte à côte */}
                                <div class="flex items-center gap-3 sm:gap-4 lg:gap-5 w-full border-b border-white/10 pb-3 sm:pb-4 lg:pb-4 shrink-0">
                                    <div class="carousel-icon flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 lg:w-14 lg:h-14 shrink-0">
                                        {typeof item.icon === "string" ? (
                                            <div class="text-3xl sm:text-4xl lg:text-4xl">
                                                {item.icon}
                                            </div>
                                        ) : (
                                            <img
                                                src={item.icon.src}
                                                alt={item.title}
                                                class="w-full h-full object-contain"
                                            />
                                        )}
                                    </div>
                                    <h3 class="uppercase tracking-wide text-base sm:text-lg lg:text-xl">
                                        {item.title}
                                    </h3>
                                </div>

                                {/* Texte en dessous */}
                                <div
                                    class="carousel-content text-xs sm:text-sm lg:text-base text-zinc-100 leading-relaxed overflow-y-auto flex-1"
                                    set:html={item.description}
                                />
                            </div>
                        ))
                    }
                </div>
            </div>

            <div
                class="h-6 flex items-center justify-center my-4 lg:my-0 lg:h-full lg:w-12"
            >
                <div
                    class="flex items-center gap-4 lg:flex-col lg:justify-center lg:items-center"
                >
                    {
                        carouselData.map((_, index) => (
                            <button
                                class={`carousel-dot w-3 h-3 lg:w-4 lg:h-4 rounded-full transition-all duration-300 hover:scale-125 ${index === 0 ? "bg-white shadow-lg shadow-violet-400/50" : "bg-white/20 hover:bg-white/40"}`}
                                data-index={index}
                                aria-label={`Voir ${carouselData[index].title}`}
                            />
                        ))
                    }
                </div>
            </div>

            <div
                class="w-full flex justify-center items-stretch gap-3 sm:gap-4 lg:flex-col lg:gap-5 lg:h-full lg:w-1/4"
            >
                {
                    [1, 2, 3].map((offset) => {
                        const step = (0 + offset) % carouselData.length;
                        return (
                            <div
                                class="carousel-preview bg-gradient-to-br from-zinc-900/95 to-zinc-950/95 rounded-2xl backdrop-blur-md w-full flex-1 flex items-center justify-center cursor-pointer transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-violet-500/20 border border-transparent hover:border-violet-500/30 py-3 text-center"
                                data-step={step}
                            >
                                <div class="flex flex-col h-full justify-start items-center gap-1 px-2 py-1 lg:p-1.5">
                                    <div class="carousel-preview-icon">
                                        {typeof carouselData[step].icon ===
                                        "string" ? (
                                            <div class="text-2xl lg:text-xl opacity-90">
                                                {carouselData[step].icon}
                                            </div>
                                        ) : (
                                            <img
                                                src={
                                                    carouselData[step].icon.src
                                                }
                                                alt={carouselData[step].title}
                                                class="h-6 lg:h-6 w-auto opacity-90"
                                            />
                                        )}
                                    </div>
                                    <span class="carousel-preview-title text-[10px] sm:text-xs lg:text-[10px] text-zinc-200 font-medium">
                                        <span class="lg:hidden">
                                            {carouselData[step].shortTitle}
                                        </span>
                                        <span class="hidden lg:inline">
                                            {carouselData[step].title}
                                        </span>
                                    </span>
                                </div>
                            </div>
                        );
                    })
                }
            </div>
        </div>
    </div>
</section>

<style>
    /* Animation de fade pour les slides */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .carousel-slide:not(.hidden) {
        animation: fadeInUp 0.5s ease-out;
    }

    /* Effet glow sur la carte principale */
    .carousel-main-card {
        box-shadow:
            0 20px 60px rgba(0, 0, 0, 0.5),
            0 0 40px rgba(139, 92, 246, 0.1);
    }

    .carousel-main-card:hover {
        box-shadow:
            0 25px 70px rgba(0, 0, 0, 0.6),
            0 0 50px rgba(139, 92, 246, 0.15);
    }

    /* Drop shadow sur les icônes */
    .carousel-icon img {
        filter: drop-shadow(0 0 12px rgba(139, 92, 246, 0.4));
    }

    .carousel-preview-icon img {
        filter: drop-shadow(0 0 8px rgba(139, 92, 246, 0.3));
    }

    /* Smooth scroll pour le contenu */
    #carousel-main {
        scroll-behavior: smooth;
    }

    /* Style pour les listes */
    .carousel-content ul {
        padding-left: 1.5rem;
    }

    .carousel-content li {
        margin-bottom: 0.75rem;
    }

    .carousel-content li::marker {
        color: rgba(139, 92, 246, 0.7);
    }
</style>

<script define:vars={{ carouselData }}>
    let activeStep = 0;
    const totalSteps = 4;

    // Données des icônes (correspondant à carouselData)
    const carouselIconsData = carouselData.map((item) => ({
        iconSrc: typeof item.icon === "string" ? item.icon : item.icon.src,
        title: item.title,
        shortTitle: item.shortTitle,
        isEmoji: typeof item.icon === "string",
    }));

    function updateCarousel(newStep) {
        activeStep = newStep;

        // Cacher tous les slides avec animation
        document.querySelectorAll(".carousel-slide").forEach((el) => {
            el.classList.add("opacity-0");
            setTimeout(() => {
                el.classList.add("hidden");
            }, 300);
        });

        // Afficher le slide actif avec animation
        setTimeout(() => {
            const activeSlide = document.querySelector(
                `.carousel-slide[data-index="${activeStep}"]`,
            );
            if (activeSlide) {
                activeSlide.classList.remove("hidden");
                setTimeout(() => {
                    activeSlide.classList.remove("opacity-0");
                    activeSlide.classList.add("opacity-100");
                }, 50);
            }
        }, 300);

        // Mettre à jour les dots avec animation
        document.querySelectorAll(".carousel-dot").forEach((dot, index) => {
            if (index === activeStep) {
                dot.classList.add(
                    "bg-white",
                    "shadow-lg",
                    "shadow-violet-400/50",
                    "scale-125",
                );
                dot.classList.remove("bg-white/20", "shadow-md");
            } else {
                dot.classList.remove(
                    "bg-white",
                    "shadow-lg",
                    "shadow-violet-400/50",
                    "scale-125",
                );
                dot.classList.add("bg-white/20");
            }
        });

        // Mettre à jour les previews
        document
            .querySelectorAll(".carousel-preview")
            .forEach((preview, idx) => {
                const offset = idx + 1;
                const step = (activeStep + offset) % totalSteps;
                preview.setAttribute("data-step", step.toString());

                const iconContainer = preview.querySelector(
                    ".carousel-preview-icon",
                );
                const title = preview.querySelector(".carousel-preview-title");

                const data = carouselIconsData[step];

                if (iconContainer && data) {
                    if (data.isEmoji) {
                        iconContainer.innerHTML = `<div class="text-3xl lg:text-4xl opacity-90">${data.iconSrc}</div>`;
                    } else {
                        iconContainer.innerHTML = `<img src="${data.iconSrc}" alt="${data.title}" class="h-8 lg:h-12 w-auto opacity-90" />`;
                    }
                }

                if (title && data) {
                    title.innerHTML = `
                        <span class="lg:hidden">${data.shortTitle}</span>
                        <span class="hidden lg:inline">${data.title}</span>
                    `;
                }
            });
    }

    // Auto-rotation
    setInterval(() => {
        updateCarousel((activeStep + 1) % totalSteps);
    }, 5000);

    // Gestion des clics sur les dots
    document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".carousel-dot").forEach((dot) => {
            dot.addEventListener("click", () => {
                const index = parseInt(dot.getAttribute("data-index") || "0");
                updateCarousel(index);
            });
        });

        // Gestion des clics sur les previews
        document.querySelectorAll(".carousel-preview").forEach((preview) => {
            preview.addEventListener("click", () => {
                const step = parseInt(preview.getAttribute("data-step") || "0");
                updateCarousel(step);
            });
        });
    });

    // Animation du texte introductif
    const animatedText = document.querySelector(".animated-text");

    if (animatedText) {
        const observer = new IntersectionObserver(
            (entries) => {
                entries.forEach((entry) => {
                    if (
                        entry.isIntersecting &&
                        animatedText.getAttribute("data-animated") === "false"
                    ) {
                        animatedText.setAttribute("data-animated", "true");
                    }
                });
            },
            {
                threshold: 0.5,
            },
        );

        observer.observe(animatedText);
    }
</script>

<style>
    .animated-text {
        background: linear-gradient(
            to right,
            var(--text-color, #ffffff) 0%,
            var(--text-color, #ffffff) 50%,
            #3600c9 50%,
            #3600c9 100%
        );
        background-size: 200% 100%;
        background-position: 100% 0;
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        transition: background-position 1.5s ease-out;
    }

    .animated-text[data-animated="true"] {
        background-position: 0% 0;
    }
</style>
